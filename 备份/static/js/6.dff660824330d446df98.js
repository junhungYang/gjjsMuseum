webpackJsonp([6],{"2xr2":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("P1bd"),a=s("cWdY"),n={data:function(){return{ticketInfoState:0,realNum:"",verificationState:0,type:"",time:"",visitNum:0,ticketInfo:{},remark:"",specList:["20 - 50 人"],timeList:["9:30-10:30","10:30-11:30","14:00-15:00","15:00-16:00","16:00-17:00","上午","下午"],pullupdata:[]}},watch:{ticketInfoState:function(t){0===t&&(this.ticketInfo={},this.type="",this.time="",this.realNum="")}},created:function(){this.getVisitNum()},computed:{judgeTime:function(){var t=["9:30-10:30","10:30-11:30","14:00-15:00","15:00-16:00","16:00-17:00","17:00-18:00"],e=[],s=new Date,i=s.getTime();e.push(s.setHours(10,30,0,0)),e.push(s.setHours(11,30,0,0)),e.push(s.setHours(15,0,0,0)),e.push(s.setHours(16,0,0,0)),e.push(s.setHours(17,0,0,0)),e.push(s.setHours(18,0,0,0));for(var a=0;a<e.length;a++)if(e[a]>=i)return t[a]},scanStatus:function(){return this.$store.state.scanStatus}},components:{"v-pullup":s("dozW").a},methods:{scanQrCode:function(){i.a.scanQrCode(this.qrCodeInfo)},qrCodeInfo:function(t){var e=this,s=t.split("=")[1];Object(a.g)({ticketNumber:s}).then(function(t){e.ticketInfo=t,e.ticketInfo.ticketNumber=s,parseInt(t.personCount)<=5?e.type="个人票（"+t.personCount+"人）":e.type="团体票（"+e.specList[0]+"）",e.realNum=parseInt(t.personCount),e.time=t.entryTime,e.ticketInfoState=1})},manualAdd:function(){this.ticketInfoState=2,this.ticketInfo={name:"未预约人"},this.type="未预约票种",this.time=this.judgeTime},verification:function(){var t=this,e=parseInt(this.realNum);return isNaN(e)?(this.pullupdata=["请输入数字"],this.$store.commit("changepullup",!0),!1):0!==this.ticketInfoState&&(1===this.ticketInfoState&&e>0?Object(a.c)({ticketNumber:this.ticketInfo.ticketNumber,peopleCount:e,remark:this.remark}).then(function(s){t.ticketInfoState=0,t.verificationState=1,setTimeout(function(){t.verificationState=0},1e3),t.visitNum+=e}):2===this.ticketInfoState&&e>0&&Object(a.b)({peopleCount:e,remark:this.remark}).then(function(){t.ticketInfoState=0,t.verificationState=1,setTimeout(function(){t.verificationState=0},1e3),t.visitNum+=e}),this.realNum="",void(this.remark=""))},sureError:function(){this.$store.commit("setScanStatus",300),this.ticketInfoState=0},cancel:function(){this.ticketInfoState=0,this.realNum="",this.remark=""},getVisitNum:function(){var t=this;Object(a.i)().then(function(e){t.visitNum=e.realNum})}}},r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"scanPage"},[i("img",{staticClass:"logo",attrs:{src:s("iQH9")}}),t._v(" "),i("p",{staticClass:"name"},[t._v("珠三角工匠精神展示馆验票系统")]),t._v(" "),i("span",{staticClass:"btn_2",on:{click:t.scanQrCode}},[t._v("点击扫码")]),t._v(" "),i("span",{staticClass:"btn_2",on:{click:t.manualAdd}},[t._v("手动添加未预约人数")]),t._v(" "),i("div",{staticClass:"ticketInfo"},[i("p",{staticClass:"title"},[t._v("门票信息")]),t._v(" "),i("ul",{staticClass:"detail"},[i("li",[i("p",[t._v("联系人")]),i("span",[t._v(t._s(t.ticketInfo.name||""))])]),t._v(" "),i("li",[i("p",[t._v("预约种类")]),i("span",[t._v(t._s(t.type||""))])]),t._v(" "),i("li",[i("p",[t._v("进馆时间")]),i("span",{directives:[{name:"show",rawName:"v-show",value:""!==t.time&&void 0!==t.time,expression:"time !== '' && time !== undefined"}]},[t._v(t._s(t._f("formatDate1")(t.time))+"（"+t._s(t._f("formatDate2")(t.time))+"）")])]),t._v(" "),i("li",{staticClass:"actualNum"},[i("p",[t._v("实际人数")]),i("span",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.realNum,expression:"realNum"}],attrs:{type:"text"},domProps:{value:t.realNum},on:{input:function(e){e.target.composing||(t.realNum=e.target.value)}}}),t._v("人")])]),t._v(" "),i("li",{staticClass:"remark"},[t._m(0),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.remark,expression:"remark"}],attrs:{placeholder:"填写未预约人或票数差异大的原因"},domProps:{value:t.remark},on:{input:function(e){e.target.composing||(t.remark=e.target.value)}}})])]),t._v(" "),i("div",{staticClass:"confirm"},[i("span",{on:{click:t.cancel}},[t._v("取消")]),t._v(" "),i("span",{staticClass:"sure",on:{click:t.verification}},[t._v("核销")])])]),t._v(" "),i("div",{staticClass:"total"},[i("p",[t._v("今天实际到场人数：")]),t._v(" "),i("p",[t._v(t._s(t.visitNum)+" 人")])]),t._v(" "),i("transition",{attrs:{name:"fade"}},[1===t.verificationState?i("div",{staticClass:"success"},[t._v("核销成功")]):t._e()]),t._v(" "),i("transition",{attrs:{name:"fade"}},[300!==t.scanStatus?i("div",{staticClass:"mark",on:{touchmove:function(t){t.preventDefault()}}},[i("div",{staticClass:"failed"},[i("p",{staticClass:"title"},[t._v("核销失败")]),t._v(" "),705===t.scanStatus?i("p",{staticClass:"reason"},[t._v("该票已经核销过了。")]):t._e(),t._v(" "),707===t.scanStatus?i("p",{staticClass:"reason"},[t._v("该票已经退票。")]):t._e(),t._v(" "),704===t.scanStatus||706===t.scanStatus?i("div",{staticClass:"reason time"},[i("p",[t._v("该票进场时间为：")]),t._v(" "),i("span",[t._v(t._s(t.ticketInfo.ticketTime))]),t._v(" "),i("span",[t._v(t._s(t._f("formatDate1")(t.time))+"（"+t._s(t._f("formatDate2")(t.time))+"）")])]):t._e(),t._v(" "),i("span",{staticClass:"sure",on:{click:t.sureError}},[t._v("确认")])])]):t._e()]),t._v(" "),i("v-pullup",{attrs:{options:t.pullupdata}})],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("备注"),e("span",[this._v("（选填）")])])}]};var c=s("C7Lr")(n,r,!1,function(t){s("9DfA")},null,null);e.default=c.exports},"9DfA":function(t,e){}});
//# sourceMappingURL=6.dff660824330d446df98.js.map